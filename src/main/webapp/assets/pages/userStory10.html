<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>LTE - User Story 10</title>

<!-- Needed for autocomplete ui -->
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<!-- <link rel="stylesheet" href="/resources/demos/style.css"> -->

<!-- JQuery library -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<!-- Needed for autocomplete ui -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script>
	//Populates autocomplete for textfield, with all unique UE Types in database.
	//Options must be strings to appear in suggestion.
	$( function() {
		//var availableTags = ["21060800", "33000153", "33000253"];
		var availableTags = [];
		$.ajax({
	        type: 'GET',
	        url: 'http://localhost:8080/LteFailureSystem-0.0.1-SNAPSHOT/api/data/all_unique_ue_types',
	        contentType: 'application/json',
	        dataType: 'json',
	        success: function (aList) {
	            $.each(aList, function (index, value) {
	                availableTags.push(value.toString()); //Converts value to String, and adds to availableTags.
	            });
	            $( "#uetype_text" ).autocomplete({
	      	      source: availableTags
	      	    });
	        }
	    });
		
	    
	  } );

    function sortTable(n) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("results");
        switching = true;
        //Set the sorting direction to ascending:
        dir = "asc";
		/*Make a loop that will continue until
		 no switching has been done:*/
        while (switching) {
            //start by saying: no switching is done:
            switching = false;
            rows = table.getElementsByTagName("TR");
			/*Loop through all table rows (except the
			 first, which contains table headers):*/
            for (i = 0; i < (rows.length - 1); i++) {
                //start by saying there should be no switching:
                shouldSwitch = false;
				/*Get the two elements you want to compare,
				 one from current row and one from the next:*/
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
				/*check if the two rows should switch place,
				 based on the direction, asc or desc:*/
                if (dir == "asc") {
                    if (parseInt(x.innerHTML.toLowerCase()) > parseInt(y.innerHTML.toLowerCase())) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch= true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (parseInt(x.innerHTML.toLowerCase()) < parseInt(y.innerHTML.toLowerCase())) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch= true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
				/*If a switch has been marked, make the switch
				 and mark that a switch has been done:*/
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                //Each time a switch is done, increase this count by 1:
                switchcount ++;
            } else {
				/*If no switching has been done AND the direction is "asc",
				 set the direction to "desc" and run the while loop again.*/
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }

	function userStory10(){
	    var ueType = document.getElementById('uetype_text').value;
	    $("#results").html("");
	    $.ajax({
	        type: 'GET',
	        //url: 'api/data/event_cause/by_ue_type/' + ueType,
	        url: 'http://localhost:8080/LteFailureSystem-0.0.1-SNAPSHOT/api/data/event_cause/by_ue_type/' + ueType,
	        contentType: 'application/json',
	        dataType: 'json',
	        success: function (aList) {
	            story10 = aList;
	            //$("#innerText").append("<table>");
	            $("#results").append("<th onclick = 'sortTable(0)'>" + "UE Type(TAC)" + "</th>" + "<th onclick = 'sortTable(1)'>" + "Event Id" + "</th>" + "<th onclick = 'sortTable(2)'>" + "Cause Code" + "</th>" + "<th onclick = 'sortTable(3)'>" + "Count" + "</th>" );
	            $.each(story10, function (index, value) {
	                $("#results").append("<tr><td>" + value[0] + "</td><td>" + value[1] + "</td><td>" + value[2] + "</td><td>" + value[3]+ "</td></tr>");
	            });
	            //$("#innerText").append("</table>");
	        }
	    });
	
	}
</script>
</head>
<body>
	<h1>User Story 10</h1>

    <p>Network Mgt Engineer: Display unique EVENT_ID/CAUSE_CODE combinations for a specific ueType
        and the number of occurrence.</p>
    <br>
    <tbody>
	    <tr>
	        <td class="name">
	            UE Type:
	        </td>
	        <td class="data">
	            <input type="text" name="uetype_text" id="uetype_text" width="20" maxlength="40" size="20">
	        </td>
	        
	        <td class="name">
	            <input type="button" id="queryBtn" value="Submit" onclick="userStory10()">
	        </td>
	    </tr>
    </tbody>

    <br>
    <br>
    <table id="results">

    </table>
</body>
</html>